# Nginx 的优势

- IO 多路复用
- 轻量级
- CPU 亲和，affinity
- sendfile 的机制，效率高

## 什么是 IO 多路复用？

IO 多路复用（I/O Multiplexing） 可以理解为一种让程序同时监控多个文件描述符（如网络连接、文件等）的技术，以便在任何一个文件描述符上发生读写事件时都能及时得到通知

### 举例说明

想象一下，你是一名服务员，需要同时照顾多个餐桌。每张桌子都有顾客在等待服务：

#### 传统方式

你每次只能照顾一张桌子，比如先去第一张桌子看看顾客是否需要服务，如果第一张桌子的顾客不需要服务，你就去第二张桌子，依此类推。这种方式效率很低，因为你每次只能处理一个顾客的需求

每次只能处理一个客户端的请求，处理完一个后再处理下一个，效率低下，因为每次只能处理一个请求

#### 多路复用方式

你站在一个可以看到所有桌子的地方，同时观察所有桌子，一旦有任何一张桌子的顾客需要服务（比如举手示意），你马上就能注意到并去处理，这样，你可以同时监控多个桌子，并且在任何一个桌子有需求时立即响应

同时监控所有客户端的连接，一旦有任何一个客户端有数据到达，程序就会立即知道并处理，这样可以同时处理多个客户端的请求，效率大大提高

#### 应用场景

在计算机中，多路复用就是让程序同时监控多个网络连接或文件，一旦有任何一个连接或文件有数据到达或需要处理，程序就会立即知道并进行相应的操作

### 总结

IO 多路复用 就是让程序能够同时监控多个文件描述符，并在任何一个文件描述符上有读写事件时立即得到通知。这样可以大大提高程序处理多个连接或文件的效率，非常适合处理大量并发请求的场景

Linux 系统中使用 Epoll 技术来实现 IO 多路复用，Epoll 是 Linux 内核 2.6 之后引入的一种更加高效的 IO 多路复用技术。在不支持 Epoll 的系统中则回退使用 Select

## Select 模型

Select，最早的多路复用技术之一，可以同时监控多个文件描述符，由于其内部实现机制的限制，Select 的性能并不高，特别是当监控的文件描述符数量较多时

- 最大文件描述符数限制：select 函数大文件描述符数限制通常是 1024 个。无法监控超过这个数量的文件描述符
- 轮询机制，即逐个检查每个文件描述符的状态。当文件描述符数量较多时，这种轮询会导致较高的 CPU 开销

## Epoll 模型

- 最大文件描述符数无限制
- 使用事件驱动机制，通过回调机制通知程序，而不是像 select 那样需要遍历所有文件描述符

## 轻量级

- 功能模块少
- 代码模块化

## CPU 亲和

是一种把 CPU 核心和 Nginx 工作进程绑定方式，把每个 worker 进程固定在一个 cpu 上执行减少切换 cpu 的 cache miss，获得更好的性能

## sendfile 的机制

在 Linux 内核 2.2 版本及之后的版本中支持 sendfile 的机制

传统文件传输方式，应用程序先从磁盘读取文件内容到内核空间，再从内核空间到用户空间，再从用户空间到内核空间再到套接字缓冲区

sendfile 实现了零拷贝（Zero Copy）机制，即数据直接从磁盘缓冲区复制到套接字缓冲区，无需经过用户空间缓冲区

由于减少了数据复制次数，传输效率显著提高
