## 工程院内部分享转载
关于web端 图片格式的优化
浏览器关于图片的优化一直在进行中，有我们常用的 gif、jpg、png、svg 等，还有相对新的图片格式，例如 webp、avif。
新的图片格式一般是在质量可以保障的情况下具有非常大的体积优势，但一般需要考验浏览器的解码能力。avif 需要较新的浏览器版本上才可以默认支持。
我们既希望在应用新的图片格式带来的性能体验优势，又希望保证使用版本较低浏览器的用户的可用性，一般我们可以通过以下的几个方法来做：
```
1. picture 标签，通过 source、srcset 来达到渐进使用的目的
2. 通过 js 检测浏览器特征是否支持，获取对应的图片格式，但应注意做好图片占位，避免抖动
3. 服务端通过 UA 判断，直接返回对应的图片格式地址
4. 直接使用最新图片格式，对于不支持的浏览器，通过外置的解码算法进行处理，例如在 service worker 中解码，社区中也有基于 WebAssembly 的解码方案
```
方案 1、2、3 为了保证兼容性都保存了多种图片格式，方案 4 则需要客户端的运算。
目前情况来看，可以考虑采用方案 1 或 3。
---

Chrome DevTools 控制台上有一些小众的 API，但是非常好用，例如 queryObjects()，它可以从原型树上反查所有直接或间接的继承了某个对象的其它对象。
如果我们想拿到所有数组对象，可以使用 queryObjects(Array.prototype)；想拿到所有对象，
可以通过 queryObjects(Object.prototype)（继承自Object.create(null) 的对象之外）。
同时，queryObjects 的执行会在内存里搜索对象前先进行一次垃圾回收。
还有，例如 WeakMap 的回收，我们就可以通过 queryObjects(WeakMap.prototype) 来观察。
对于内存泄露导致频繁 gc，会导致卡顿，这些通过控制台 performance 来观察，通过 memory 来分析，社区有很多文章来分析。
对于 node 中希望手动进行 gc，需要开启 --expose-gc